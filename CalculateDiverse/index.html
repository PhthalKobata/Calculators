<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="./css/index.css">
        <title>多様性数理モデルエンジンv.1.0</title>
    </head>

    <body>
    <div id="setting" style="display:block">

        <div>
            <p>グループの数</p>
            <input type="number" id="groupCount" style="width:100px" min="1" max="100" value="1">
        </div>
        <hr>
        <div>
            <p>定義域</p>
            <span id="domain">
                <input type="text" id="domain0" style="width:500px" value=""><br>
            </span>
            <input type="button" value="定義域を追加" onclick="addDomain()"><br>
        </div>
        <hr>
        <div>
            <p>分析方法</p>
            <input type="radio" id="detail" name="analysisType" value="detail" onclick="showFroms({'addOption1':'block'})">
            <label for="detail">各性質の偏在を考慮して分析</label>
            <input type="radio" id="simple" name="analysisType" value="simple" onclick="showFroms({'addOption1':'block'})">
            <label for="simple">各性質の比率だけを考慮して分析</label>
        </div>

        <div id="addOption1" style="display:none;">
            <p>グループに要素を振り分ける方法</p>
            <input type="radio" id="manualValue" name="importValue" value="manual" onclick="showFroms({'addOption2':'none', 'createTable':'block'})">
            <label for="manualValue">手動で振り分け</label>
            <br>
            <input type="radio" id="randomValue" name="importValue" value="random" onclick="showFroms({'addOption2':'block', 'createTable':'none'})">
            <label for="randomValue">ランダムに振り分け</label><br>

            <div id="addOption2" style="display:none;">
                <p>グループの持つ要素数の決定</p>
                <input type="radio" id="manualRatio" name="importRatio" value="manual" onclick="showFroms({'createTable':'block'})">
                <label for="manualRatio">手動で振り分け</label>
                <br>
                <input type="radio" id="randomRatio" name="importRatio" value="random" onclick="showFroms({'createTable':'block'})">
                <label for="randomRatio">ランダムに振り分け</label>
                <br>
                <div>
                    繰り返し回数：<input type="number" style="width:100px" id="loopCount" min="1" max="10000" value="1">
                </div>
            </div>
        </div>

        <div id="createTable" style="display:none;">
            <br>
            <input type="button" value="要素設定表を作成" onclick="createTable()">
        </div>
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="importTable" style="display:none;">
        <span class="showTitle">集団の数：</span><span id="showGroupCount" class="showData"></span>
        <br>
        <span class="showTitle">定義域：</span><span id="showDomains" class="showData"></span>
        <br>
        <span class="showTitle">繰り返し回数：</span><span id="showLoopCount" class="showData"></span>
        <br>
        <hr>
        <input type="button" value="設定を変更する" onclick="openSetting()">
        <br>
        <hr>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="manualTable" style="display:none;">
            <span id="importButton_manualMatrix"></span>
            <br>
            <table><tbody id="manualMatrix">

            </tbody></table>    
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="randomTable" style="display:none;">
            <table><tbody>
                <tr>
                    <td><span id="importButton_randomMatrix_material"></span></td>
                    <td calss="margin"></td>
                    <td><span id="importButton_randomMatrix_group"></span></td>
                </tr>
                <tr>
                    <td></td>
                    <td calss="margin" style="height: 20px;"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>各要素の合計</td>
                    <td calss="margin"></td>
                    <td>各グループに含まれる定義域ごとの要素数</td>
                </tr>
                <tr>
                    <td><table><tbody id="randomMatrix_material">
    
                    </tbody></table></td>
    
                    <td calss="margin"></td>
    
                    <td><table><tbody id="randomMatrix_group">
    
                    </tbody></table></td>
                </tr>
            </tbody></table>    
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <input type="button" value="多様性を計算" onclick="resultShow()">
    
    </div>
    <hr>
    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="resultFroms" style="display:none;">
        <input type="checkbox" id="dlData_detail" name="dlDataType" value="dlData_detail" checked>
        <label for="dlData_detail">詳細分析結果</label>
        <input type="checkbox" id="dlData_simple" name="dlDataType" value="dlData_simple" checked>
        <label for="dlData_simple">簡易分析結果</label>
        
        <br>

        <input type="checkbox" id="dlData_btwGroups" name="dlData" value="dlData_btwGroups" checked>
        <label for="dlData_btwGroups">集団間の多様性</label>
        <input type="checkbox" id="dlData_averageDiverse" name="dlData" value="dlData_averageDiverse" checked>
        <label for="dlData_averageDiverse">集団内多様性の平均</label>
        <input type="checkbox" id="dlData_sdDiverse" name="dlData" value="dlData_sdDiverse" checked>
        <label for="dlData_sdDiverse">集団内多様性の標準偏差</label>
        <input type="checkbox" id="dlData_eachDiverse" name="dlData" value="dlData_eachDiverse">
        <label for="dlData_eachDiverse">各集団内の多様性</label>
        <input type="checkbox" id="dlData_slicedGroups" name="dlData" value="dlData_slicedGroups">
        <label for="dlData_slicedGroups">各集団内の要素の内訳</label>
        <br>
        ファイル名：<input type="text" id="fileName" value="result" style="width:300px">
        <input type="button" value="結果をテキストに保存" onclick="downloadText()">
        <br>
        <p>結果を100個まで表示</p>
        <table>
            <tbody>
                <tr>
                    <th><span class="showTitle">集団間の多様性（詳細分析）</span></th>
                    <th><span class="showTitle">集団内多様性の平均（詳細分析）</span></th>
                    <th><span class="showTitle">集団内多様性の標準偏差（詳細分析）</span></th>
                    <th><span class="showTitle">集団間の多様性（簡易分析）</span></th>
                    <th><span class="showTitle">集団内多様性の平均（簡易分析）</span></th>
                    <th><span class="showTitle">集団内多様性の標準偏差（簡易分析）</span></th>
                    <th><span class="showTitle">各集団内の多様性（詳細分析）</span></th>
                    <th><span class="showTitle">各集団内の多様性（簡易分析）</span></th>
                    <th><span class="showTitle">各集団の要素の内訳</span></th>
                </tr>
                <tr>
                    <td style="width:200px"><span id="result-btw_detail" class="showData"></span></td>
                    <td style="width:200px"><span id="result-ave_detail" class="showData"></span></td>
                    <td style="width:200px"><span id="result-sd_detail" class="showData"></span></td>
                    <td style="width:200px"><span id="result-btw_simple" class="showData"></span></td>
                    <td style="width:200px"><span id="result-ave_simple" class="showData"></span></td>
                    <td style="width:200px"><span id="result-sd_simple" class="showData"></span></td>
                    <td><span id="result-each_detail" class="showData"></span></td>
                    <td><span id="result-each_simple" class="showData"></span></td>
                    <td><span id="result-slicedGroups" class="showData"></span></td>
                </tr>
            </tbody>
        </table>
        
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <script text="type/javascript" src="./js/CalculateDiverse.js"></script>
    <script text="type/javascript" src="./js/CreateFrom.js"></script>
    <script text="type/javascript" src="./js/CreateResult.js"></script>
    <script text="type/javascript">

        const createForm = new CreateForm();
        let createResult = null;

        const showFroms = (displayStyles) => {
            //displayStyles:{id1:displayStyle1, ...}
            Object.keys(displayStyles).forEach((id) => {
                document.getElementById(id).style.display = displayStyles[id];
            });
        };

        const addDomain = () => {
            createForm.addDomain();
        };

        const createTable = () => {
            createForm.main();
            if(createForm.valid()){
                showFroms({'importTable':'block', 'setting':'none'});
            };
        };

        const autoImport = (tbodyId) => {
            createForm.autoImport(tbodyId);
        };

        const openSetting = () => {
            createForm.removeTable('manualMatrix');
            createForm.removeTable('randomMatrix_material');
            createForm.removeTable('randomMatrix_group');
            createForm.initialize();
            showFroms({'importTable':'none', 'setting':'block', 'resultFroms':'none', 'manualTable':'none', 'randomTable':'none'});
        };

        const resultShow = () => {
            showFroms({'resultFroms':'block'});
            createResult = new CreateResult(createForm.parameters());
            createResult.main();
        };

        const downloadText = () => {
            const result = createResult.result();
            const params = createResult.params();
            const downloadResult = new DownloadResult(result, params);
            downloadResult.main();
        };

    </script>
    </body>
</html>
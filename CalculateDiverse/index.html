<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="./css/index.css">
        <title>多様性数理モデルエンジンv.1.0</title>
    </head>

    <body>
    <div id="setting" style="display:block">

        <div>
            <p>群集に含まれる集団の数</p>
            <input type="number" id="groupCount" style="width:100px" min="1" max="100" value="1">
        </div>
        <hr>
        <div>
            <p>定義域</p>
            <span id="domain">
                <input type="text" id="domain0" style="width:500px" value=""><br>
            </span>
            <input type="button" id="addDomain" value="定義域を追加"><br>
        </div>
        <hr>

        <div id="addOption1" style="display:block;">
            <p>各集団に含まれる要素の内訳を決める方法</p>
            <input type="radio" id="fixedValue" name="importValue" value="fixed">
            <label for="fixedValue">各集団の要素の内訳は固定</label>
            <br>
            <input type="radio" id="randomValue" name="importValue" value="random">
            <label for="randomValue">各集団の要素の内訳はランダム</label><br>

            <div id="addOption2" style="display:none;">
                <p>各集団に含まれる要素数を決める方法</p>
                <input type="radio" id="fixedRatio" name="importRatio" value="fixed">
                <label for="fixedRatio">各集団に入る要素数は固定</label>
                <br>
                <input type="radio" id="randomRatio" name="importRatio" value="random">
                <label for="randomRatio">各集団に入る要素数はランダム</label>
                <br>
                <div>
                    繰り返し回数：<input type="number" style="width:100px" id="loopCount" min="1" max="10000" value="1">
                </div>
            </div>
        </div>

        <div id="createTable" style="display:none;">
            <br>
            <input type="button" id="createTableButton" value="要素数と集団数を設定する">
        </div>
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="importTable" style="display:none;">
        <span class="showTitle">群集に含まれる集団の数：</span><span id="showGroupCount" class="showData"></span>
        <br>
        <span class="showTitle">定義域：</span><span id="showDomains" class="showData"></span>
        <br>
        <span class="showTitle">繰り返し回数：</span><span id="showLoopCount" class="showData"></span>
        <br>
        <hr>
        <input type="button" id="openSetting" value="設定を変更する">
        <br>
        <hr>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="fixedTable" style="display:none;">
            <span id="importButton-fixedMatrix"></span>
            <br>
        <table><tbody>
                <tr>
                    <td>
                        <table><tbody id="fixedMatrix">

                        </tbody></table>                        
                    </td>
                    <td>
                        <table><tbody id="totalRows-fixedMatrix">
                            
                        </tbody></table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table><tbody id="totalColumns-fixedMatrix">

                        </tbody></table>
                    </td>
                    <td><span style="color: blue;" id="total-fixedMatrix"></span></td>
                </tr>
            </tbody></table>
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="randomTable" style="display:none;">
            <table><tbody>
                <tr>
                    <td><span id="importButton-randomMatrix_material"></span></td>
                    <td calss="margin"></td>
                    <td><span id="importButton-randomMatrix_group"></span></td>
                </tr>
                <tr>
                    <td></td>
                    <td calss="margin" style="height: 20px;"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>各要素の合計</td>
                    <td calss="margin"></td>
                    <td>各グループに含まれる要素数</td>
                </tr>
                <tr>
                    <td><table><tbody id="randomMatrix_material">
    
                    </tbody></table></td>
    
                    <td calss="margin"></td>
    
                    <td><table><tbody id="randomMatrix_group">
    
                    </tbody></table></td>
                </tr>
                <tr>
                    <td>
                        <table><tbody id="totalColumns-randomMatrix_material">

                        </tbody></table>
                    </td>
                    <td calss="margin"></td>
                    <td>
                        <table><tbody id="totalColumns-randomMatrix_group">
                            
                        </tbody></table>
                    </td>
                </tr>
            </tbody></table>    
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <input type="button" id="resultShow" value="多様性を計算">
    
    </div>
    <hr>
    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="resultFroms" style="display:none;">
        <input type="checkbox" id="dlData_btwGroups" name="dlData" value="dlData_btwGroups" checked>
        <label for="dlData_btwGroups">集団間の多様性</label>
        <input type="checkbox" id="dlData_averageDiverse" name="dlData" value="dlData_averageDiverse" checked>
        <label for="dlData_averageDiverse">集団内多様性の平均</label>
        <input type="checkbox" id="dlData_sdDiverse" name="dlData" value="dlData_sdDiverse" checked>
        <label for="dlData_sdDiverse">集団内多様性の標準偏差</label>
        <input type="checkbox" id="dlData_eachDiverse" name="dlData" value="dlData_eachDiverse">
        <label for="dlData_eachDiverse">各集団内の多様性</label>
        <input type="checkbox" id="dlData_slicedGroups" name="dlData" value="dlData_slicedGroups">
        <label for="dlData_slicedGroups">各集団内の要素の内訳</label>
        <br>
        ファイル名：<input type="text" id="fileName" value="result" style="width:300px">
        <input type="button" id="downloadText" value="結果をテキストに保存">
        <br>
        <p>結果を100個まで表示</p>
        <table>
            <tbody>
                <tr>
                    <th><span class="showTitle">集団間の多様性</span></th>
                    <th><span class="showTitle">集団内多様性の平均</span></th>
                    <th><span class="showTitle">集団内多様性の標準偏差</span></th>
                    <th><span class="showTitle">各集団内の多様性</span></th>
                    <th><span class="showTitle">各集団の要素の内訳</span></th>
                </tr>
                <tr>
                    <td style="width:200px"><span id="result-btw" class="showData"></span></td>
                    <td style="width:200px"><span id="result-ave" class="showData"></span></td>
                    <td style="width:200px"><span id="result-sd" class="showData"></span></td>
                    <td><span id="result-each" class="showData"></span></td>
                    <td><span id="result-slicedGroups" class="showData"></span></td>
                </tr>
            </tbody>
        </table>
        
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <script text="type/javascript" src="./js/CalculateDiverse.js"></script>
    <script text="type/javascript" src="./js/CreateFrom.js"></script>
    <script text="type/javascript" src="./js/CreateResult.js"></script>
    <script text="type/javascript">


        document.addEventListener('DOMContentLoaded', () => {
            let createResult = null;
            createForm = new CreateForm();
        
            const showFroms = (displayStyles) => {
                //displayStyles:{id1:displayStyle1, ...}
                Object.keys(displayStyles).forEach((id) => {
                    document.getElementById(id).style.display = displayStyles[id];
                });
            };

            document.getElementById('addDomain').addEventListener('click', () => {
                createForm.addDomain();
            });

            document.getElementById('fixedValue').addEventListener('click', () => {
                showFroms({'addOption2':'none', 'createTable':'block'});
            });

            document.getElementById('randomValue').addEventListener('click', () => {
                showFroms({'addOption2':'block', 'createTable':'none'});
            });

            document.getElementById('fixedRatio').addEventListener('click', () => {
                showFroms({'createTable':'block'});
            });

            document.getElementById('randomRatio').addEventListener('click', () => {
                showFroms({'createTable':'block'});
            });

            document.getElementById('createTableButton').addEventListener('click', () => {
                createForm.main();
                if(createForm.valid()){
                    showFroms({'importTable':'block', 'setting':'none'});
                };
                createForm.resizeTable();
            });

            document.getElementById('openSetting').addEventListener('click', () => {
                const tbodyIds = [
                    'fixedMatrix',
                    'randomMatrix_material',
                    'randomMatrix_group',
                    'totalRows-fixedMatrix',
                    'totalColumns-fixedMatrix',
                    'totalColumns-randomMatrix_material',
                    'totalColumns-randomMatrix_group'
                ];
                createForm.removeTables(tbodyIds);
                createForm.initialize();
                showFroms({'importTable':'none', 'setting':'block', 'resultFroms':'none', 'fixedTable':'none', 'randomTable':'none'});
            });

            document.getElementById('resultShow').addEventListener('click', () => {
                showFroms({'resultFroms':'block'});
                createResult = new CreateResult(createForm.params());
                createResult.deleteResults();
                createResult.main();
            });

            document.getElementById('downloadText').addEventListener('click', () => {
                const result = createResult.result();
                const params = createResult.params();
                const downloadResult = new DownloadResult(result, params);
                downloadResult.main();
            });
        });

    </script>
    </body>
</html>
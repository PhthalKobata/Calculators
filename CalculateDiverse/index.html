<!DOCTYPE html>
<html lang="ja">
    <!--
     * @author こばた ふたる
     * twitter: https://twitter.com/Kass_kobataku
     * github: https://github.com/PhthalKobata
     * misskey.io: https://misskey.io/@phKobata
     * note: https://note.com/phta_kobata
     * 
     * @help
     * 著作権は こばた ふたる に帰属しますが、利用や改変は自由です。
    -->
    <head>
        <meta charset="utf-8" name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <title>多様性数理モデルエンジンv.1.0</title>
    </head>

    <body>
    <div id="setting" style="display:block">

        <div>
            <p>群集に含まれる集団の数</p>
            <input type="number" id="groupCount" style="width:100px" min="1" max="100" value="1" title="群集に含まれる集団の数">
        </div>
        <hr>
        <div>
            <p>定義域</p>
            <span id="domain">
                <input type="text" id="domain0" style="width:500px" value="" title="群集に含まれる集団の数"><br>
            </span>
            <input type="button" id="addDomain" value="定義域を追加"><br>
        </div>
        <hr>

        <div id="addOption1" style="display:block;">
            <p>各集団に含まれる要素の内訳を決める方法</p>
            <input type="radio" id="fixedValue" name="importValue" value="fixed">
            <label for="fixedValue">各集団の要素の内訳は固定</label>
            <br>
            <input type="radio" id="randomValue" name="importValue" value="random">
            <label for="randomValue">各集団の要素の内訳はランダム</label><br>

            <div id="addOption2" style="display:none;">
                <p>各集団に含まれる要素数を決める方法</p>
                <input type="radio" id="fixedRatio" name="importRatio" value="fixed">
                <label for="fixedRatio">各集団に入る要素数は固定</label>
                <br>
                <input type="radio" id="randomRatio" name="importRatio" value="random">
                <label for="randomRatio">各集団に入る要素数はランダム</label>
                <br>
                <div>
                    繰り返し回数：<input type="number" style="width:100px" id="loopCount" min="1" max="10000" value="1" title="繰り返し回数">
                </div>
            </div>
        </div>

        <div id="createTable" style="display:none;">
            <br>
            <input type="button" id="createTableButton" value="要素数と集団数を設定する">
        </div>
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="importTable" style="display:none;">
        <span class="showParamTitle">群集に含まれる集団の数：</span><span id="showGroupCount" class="showParamData"></span>
        <br>
        <span class="showParamTitle">定義域：</span><span id="showDomains" class="showParamData"></span>
        <br>
        <span class="showParamTitle">繰り返し回数：</span><span id="showLoopCount" class="showParamData"></span>
        <br>
        <hr>
        <input type="button" id="openSetting" value="設定を変更する">
        <br>
        <hr>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="fixedTable" style="display:none;">
            <span id="importButton-fixedMatrix"></span>
            <br>
        <table><tbody>
                <tr>
                    <td>
                        <table><tbody id="fixedMatrix">

                        </tbody></table>                        
                    </td>
                    <td>
                        <table><tbody id="totalRows-fixedMatrix">
                            
                        </tbody></table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <table><tbody id="totalColumns-fixedMatrix">

                        </tbody></table>
                    </td>
                    <td><span style="color: blue;" id="total-fixedMatrix"></span></td>
                </tr>
            </tbody></table>
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <div id="randomTable" style="display:none;">
            <table><tbody>
                <tr>
                    <td><span id="importButton-randomMatrix_material"></span></td>
                    <td calss="margin"></td>
                    <td><span id="importButton-randomMatrix_group"></span></td>
                </tr>
                <tr>
                    <td></td>
                    <td calss="margin" style="height: 20px;"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>各要素の合計</td>
                    <td calss="margin"></td>
                    <td>各集団に含まれる要素数</td>
                </tr>
                <tr>
                    <td><table><tbody id="randomMatrix_material">
    
                    </tbody></table></td>
    
                    <td calss="margin"></td>
    
                    <td><table><tbody id="randomMatrix_group">
    
                    </tbody></table></td>
                </tr>
                <tr>
                    <td>
                        <table><tbody id="totalColumns-randomMatrix_material">

                        </tbody></table>
                    </td>
                    <td calss="margin"></td>
                    <td>
                        <table><tbody id="totalColumns-randomMatrix_group">
                            
                        </tbody></table>
                    </td>
                </tr>
            </tbody></table>    
        </div>
        <!------------------------------------------------------------------------------------------------------------------------>
        <input type="button" id="resultShow" value="多様性を計算">
    
    </div>
    <hr>
    <!------------------------------------------------------------------------------------------------------------------------>

    <div id="resultFroms" style="display:none;">
        <p>保存する結果</p>
        <input type="checkbox" id="dlData_synthesis_btw" name="dlData" value="dlData_synthesis_btw" checked>
        <label for="dlData_synthesis_btw">集団間多様性</label>
        <input type="checkbox" id="dlData_synthesis_in" name="dlData" value="dlData_synthesis_in" checked>
        <label for="dlData_synthesis_in">集団内多様性</label>
        <input type="checkbox" id="dlData_ave_btw" name="dlData" value="dlData_ave_btw" checked>
        <label for="dlData_ave_btw">各要素の集団間の平均</label>
        <input type="checkbox" id="dlData_ave_in" name="dlData" value="dlData_ave_in" checked>
        <label for="dlData_ave_in">各集団の集団内の平均</label>
        <input type="checkbox" id="dlData_sd_btw" name="dlData" value="dlData_sd_btw" checked>
        <label for="dlData_sd_btw">各要素の集団間の標準偏差</label>
        <input type="checkbox" id="dlData_sd_in" name="dlData" value="dlData_sd_in" checked>
        <label for="dlData_sd_in">各集団の集団内の標準偏差</label>
        <input type="checkbox" id="dlData_absolute" name="dlData" value="dlData_absolute" checked>
        <label for="dlData_absolute">複素多様性絶対値</label>
        <input type="checkbox" id="dlData_angle" name="dlData" value="dlData_angle" checked>
        <label for="dlData_angle">偏角</label>
        <input type="checkbox" id="dlData_each_btw" name="dlData" value="dlData_each_btw" checked>
        <label for="dlData_each_btw">各要素の集団間</label>
        <input type="checkbox" id="dlData_each_in" name="dlData" value="dlData_each_in" checked>
        <label for="dlData_each_in">各集団の集団内</label>
        <input type="checkbox" id="dlData_slicedGroups" name="dlData" value="dlData_slicedGroups" checked>
        <label for="dlData_slicedGroups">群集の内訳</label>
        <br>
        ファイル名：<input type="text" id="fileName" value="result" style="width:300px" title="保存するファイル名">
        <input type="button" id="downloadText" value="結果をテキストに保存">
        <br>
        <p>結果を100個まで表示</p>
        <table>
            <tbody>
                <tr>
                    <th><span class="showTitle">集団間多様性</span></th>
                    <th><span class="showTitle">集団内多様性</span></th>
                    <th><span class="showTitle">各要素の集団間多様性の平均</span></th>
                    <th><span class="showTitle">各集団の集団内多様性の平均</span></th>
                    <th><span class="showTitle">各要素の集団間多様性の標準偏差</span></th>
                    <th><span class="showTitle">各集団の集団内多様性の標準偏差</span></th>
                    <th><span class="showTitle">複素多様性絶対値</span></th>
                    <th><span class="showTitle">偏角</span></th>
                    <th><span class="showTitle">各要素の集団間多様性</span></th>
                    <th><span class="showTitle">各集団の集団内多様性</span></th>
                    <th><span class="showTitle">群集の内訳</span></th>
                </tr>
                <tr>
                    <td style="width:200px"><span id="result-synthesis_btw" class="showData"></span></td>
                    <td style="width:200px"><span id="result-synthesis_in" class="showData"></span></td>
                    <td style="width:200px"><span id="result-ave_btw" class="showData"></span></td>
                    <td style="width:200px"><span id="result-ave_in" class="showData"></span></td>
                    <td style="width:200px"><span id="result-sd_btw" class="showData"></span></td>
                    <td style="width:200px"><span id="result-sd_in" class="showData"></span></td>
                    <td style="width:200px"><span id="result-absolute" class="showData"></span></td>
                    <td style="width:200px"><span id="result-angle" class="showData"></span></td>
                    <td><span id="result-each_btw" class="showData"></span></td>
                    <td><span id="result-each_in" class="showData"></span></td>
                    <td><span id="result-slicedGroups" class="showData"></span></td>
                </tr>
            </tbody>
        </table>
        
    </div>

    <!------------------------------------------------------------------------------------------------------------------------>

    <script text="type/javascript" src="./js/CalculateDiverse.js"></script>
    <script text="type/javascript" src="./js/CreateFrom.js"></script>
    <script text="type/javascript" src="./js/CreateResult.js"></script>
    <script text="type/javascript">

        document.addEventListener('DOMContentLoaded', () => {
            const createForm = new CreateForm();
        
            const showFroms = (displayStyles) => {
                //displayStyles:{id1:displayStyle1, ...}
                Object.keys(displayStyles).forEach((id) => {
                    document.getElementById(id).style.display = displayStyles[id];
                });
            };

            document.getElementById('addDomain').addEventListener('click', () => {
                createForm.addDomain();
            });

            document.getElementById('fixedValue').addEventListener('click', () => {
                showFroms({'addOption2':'none', 'createTable':'block'});
            });

            document.getElementById('randomValue').addEventListener('click', () => {
                showFroms({'addOption2':'block', 'createTable':'none'});
            });

            document.getElementById('fixedRatio').addEventListener('click', () => {
                showFroms({'createTable':'block'});
            });

            document.getElementById('randomRatio').addEventListener('click', () => {
                showFroms({'createTable':'block'});
            });

            document.getElementById('createTableButton').addEventListener('click', () => {
                createForm.main();
                if(createForm.valid()){
                    showFroms({'importTable':'block', 'setting':'none'});
                };
                createForm.resizeTable();
            });

            document.getElementById('openSetting').addEventListener('click', () => {
                const tbodyIds = [
                    'fixedMatrix',
                    'randomMatrix_material',
                    'randomMatrix_group',
                    'totalRows-fixedMatrix',
                    'totalColumns-fixedMatrix',
                    'totalColumns-randomMatrix_material',
                    'totalColumns-randomMatrix_group'
                ];
                createForm.removeTables(tbodyIds);
                createForm.initialize();
                showFroms({'importTable':'none', 'setting':'block', 'resultFroms':'none', 'fixedTable':'none', 'randomTable':'none'});
            });

            document.getElementById('resultShow').addEventListener('click', () => {
                showFroms({'resultFroms':'block'});
                createResult = new CreateResult(createForm.params());
                createResult.deleteResults();
                createResult.main();
            });

            document.getElementById('downloadText').addEventListener('click', () => {
                const result = createResult.result();
                const params = createResult.params();
                const downloadResult = new DownloadResult(result, params);
                downloadResult.main();
            });
        });

    </script>
    </body>
</html>